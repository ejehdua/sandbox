<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>×¦×•×¤×Ÿ ×§×•×“×© ×”×§×•×“×©×™×</title>
  <!-- ×©××•×¨/×™ ××ª ×‘×œ×•×§ ×”-CSS ×”×§×™×™× ×©×œ×š ×›××•×ª ×©×”×•× -->
</head>
<body style="background: transparent !important;">
  <div class="game-container"
       style="background: transparent !important; box-shadow: none !important;">
    <h1 class="title">ğŸ—ï¸ ×¦×•×¤×Ÿ ×§×•×“×© ×”×§×•×“×©×™×</h1>
    <p class="subtitle">×’×¨×•×¨ ××ª ×›×œ×™ ×”××©×›×Ÿ ×œ××§×•×× ×”× ×›×•×Ÿ</p>

    <div class="vessels-container" style="background: transparent !important;">
      <div class="vessel bronze" draggable="true" data-vessel="altar">
        ğŸ”¥
        <div class="vessel-tooltip">××–×‘×— ×”×¢×•×œ×”</div>
      </div>
      <div class="vessel bronze" draggable="true" data-vessel="laver">
        ğŸ’§
        <div class="vessel-tooltip">×›×™×•×¨</div>
      </div>
      <div class="vessel gold" draggable="true" data-vessel="menorah">
        ğŸ•¯ï¸
        <div class="vessel-tooltip">×× ×•×¨×”</div>
      </div>
      <div class="vessel gold" draggable="true" data-vessel="table">
        ğŸ
        <div class="vessel-tooltip">×©×•×œ×—×Ÿ ×œ×—× ×”×¤× ×™×</div>
      </div>
      <div class="vessel gold" draggable="true" data-vessel="incense">
        ğŸ’¨
        <div class="vessel-tooltip">××–×‘×— ×”×§×˜×•×¨×ª</div>
      </div>
      <div class="vessel gold" draggable="true" data-vessel="ark">
        â¬œ
        <div class="vessel-tooltip">××¨×•×Ÿ ×”×‘×¨×™×ª</div>
      </div>
    </div>

    <div class="tabernacle-layout">
      <div class="courtyard" style="background: transparent !important;">
        <div class="area-title">×—×¦×¨</div>
        <div class="drop-zone courtyard-drop-zone" data-area="courtyard">
          <div class="drop-circle" data-area="courtyard" data-position="courtyard-0"></div>
          <div class="drop-circle" data-area="courtyard" data-position="courtyard-1"></div>
        </div>

        <div class="kodesh" style="background: transparent !important;">
          <div class="area-title">×§×•×“×©</div>
          <!-- ×—×©×•×‘×” ×¤×¨×™×¡×ª ×”×¢×™×’×•×œ×™×: 
               kodesh-0 = ×¦×¤×•×Ÿ (×©×××œ ×œ××¢×œ×”), kodesh-1 = ×“×¨×•× (×™××™×Ÿ ×œ××¢×œ×”), kodesh-2 = ××¨×›×– (×©×•×¨×” ×©× ×™×™×”, ×××¦×¢) -->
          <div class="drop-zone kodesh-drop-zone" data-area="kodesh">
            <div class="drop-circle" data-area="kodesh" data-position="kodesh-0" title="×¦×¤×•×Ÿ"></div>
            <div class="drop-circle" data-area="kodesh" data-position="kodesh-1" title="×“×¨×•×"></div>
            <div class="drop-circle" data-area="kodesh" data-position="kodesh-2" title="××¨×›×–"></div>
          </div>

          <div class="kodesh-kodashim" style="background: transparent !important;">
            <div class="area-title">×§×•×“×© ×”×§×•×“×©×™×</div>
            <div class="drop-zone" data-area="kodesh-kodashim">
              <div class="drop-circle" data-area="kodesh-kodashim" data-position="kodesh-kodashim-0"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="controls">
      <button class="hint-icon" onclick="toggleHints()" title="×”×¦×’ ×¨××–×™×">ğŸ’¡</button>
      <button class="btn check-btn" onclick="checkPlacement()">×‘×“×•×§ ××™×§×•×</button>
      <button class="reset-icon" onclick="resetGame()" title="×”×ª×—×œ ××—×“×©">ğŸ”„</button>
    </div>

    <div class="compass">
      <div class="compass-container">
        <div class="compass-needle"></div>
        <div class="compass-directions">
          <span class="north">×¦</span>
          <span class="south">×“</span>
          <span class="east">×</span>
          <span class="west">××¢</span>
        </div>
      </div>
    </div>

    <div class="results" id="results" style="display: none;">
      <div class="score" id="score"></div>
      <div id="feedback"></div>
    </div>

    <div class="hints" id="hints">
      <h3 style="color: #8b4513; margin-bottom: 15px;">ğŸ’¡ ×¨××–×™× ×œ××™×§×•× ×”×›×œ×™×:</h3>
      <div class="hint-item" id="hint-courtyard" style="display: none;">
        ğŸ”¥ <strong>×—×¦×¨:</strong> ×›×œ×™ ×”× ×—×•×©×ª â€” ××–×‘×— ×”×¢×•×œ×” ×•×›×™×•×¨
      </div>
      <div class="hint-item" id="hint-kodesh" style="display: none;">
        âœ¨ <strong>×§×•×“×©:</strong> ×× ×•×¨×” (×“×¨×•×), ×©×•×œ×—×Ÿ (×¦×¤×•×Ÿ), ××–×‘×— ×”×§×˜×•×¨×ª (××¨×›×–)
      </div>
      <div class="hint-item" id="hint-kodesh-kodashim" style="display: none;">
        ğŸ‘‘ <strong>×§×•×“×© ×”×§×•×“×©×™×:</strong> ××¨×•×Ÿ ×”×‘×¨×™×ª ×‘×œ×‘×“
      </div>
    </div>

    <div class="final-cipher" id="final-cipher" style="background: transparent !important; border: none !important;">
      <div class="cipher-text">ğŸ—ï¸ ×”×¦×•×¤×Ÿ × ×—×©×£!</div>
      <div class="cipher-explanation">
        ×”××™×œ×” ×”×¡×•×“×™×ª ×”×™×: <strong>"×§×“×•×©×”"</strong><br><br>
        ×›×œ ×›×œ×™ ×‘××§×•××• ×”× ×›×•×Ÿ ×™×•×¦×¨ ××ª ××‘× ×” ×”××©×›×Ÿ,<br>
        ×”××¡××œ ×“×¨×’×•×ª ×§×“×•×©×” ××—×¦×¨ ××œ ×§×•×“×© ×”×§×•×“×©×™×.<br><br>
        ğŸ›ï¸ ×—×¦×¨ â† ×§×•×“×© â† ×§×•×“×© ×”×§×•×“×©×™× ğŸ›ï¸
      </div>
    </div>
  </div>

  <script>
    let draggedElement = null;
    let correctPlacements = 0;
    const totalVessels = 6;

    // ××™×¤×•×™ ××“×•×™×§ ×œ×¢×™×’×•×œ×™×:
    // ×‘×§×•×“×©: kodesh-0 = ×¦×¤×•×Ÿ (×©×•×œ×—×Ÿ), kodesh-1 = ×“×¨×•× (×× ×•×¨×”), kodesh-2 = ××¨×›×– (×§×˜×•×¨×ª)
    const correctPositions = {
      altar: 'courtyard-0',
      laver: 'courtyard-1',
      table: 'kodesh-0',          // ×¦×¤×•×Ÿ
      menorah: 'kodesh-1',        // ×“×¨×•×
      incense: 'kodesh-2',        // ××¨×›×–
      ark: 'kodesh-kodashim-0'
    };

    const vesselNames = {
      altar: '××–×‘×— ×”×¢×•×œ×”',
      laver: '×›×™×•×¨',
      menorah: '×× ×•×¨×”',
      table: '×©×•×œ×—×Ÿ ×œ×—× ×”×¤× ×™×',
      incense: '××–×‘×— ×”×§×˜×•×¨×ª',
      ark: '××¨×•×Ÿ ×”×‘×¨×™×ª'
    };

    document.addEventListener('DOMContentLoaded', function () {
      const vessels = document.querySelectorAll('.vessel');
      const dropCircles = document.querySelectorAll('.drop-circle');

      vessels.forEach(v => {
        v.addEventListener('dragstart', handleDragStart);
        v.addEventListener('dragend', handleDragEnd);
      });

      dropCircles.forEach(c => {
        c.addEventListener('dragover', handleDragOver);
        c.addEventListener('dragenter', handleDragEnter);
        c.addEventListener('dragleave', handleDragLeave);
        c.addEventListener('drop', handleDrop);
      });
    });

    function handleDragStart(e) {
      draggedElement = this;
      this.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('text/html', this.outerHTML);
    }

    function handleDragEnd() {
      this.classList.remove('dragging');
      draggedElement = null;
    }

    function handleDragOver(e) {
      if (e.preventDefault) e.preventDefault();
      e.dataTransfer.dropEffect = 'move';
      return false;
    }

    function handleDragEnter() {
      this.classList.add('drag-over');
    }

    function handleDragLeave() {
      this.classList.remove('drag-over');
    }

    function handleDrop(e) {
      if (e.stopPropagation) e.stopPropagation();
      this.classList.remove('drag-over');

      if (draggedElement && this.children.length === 0) {
        const original = draggedElement.parentNode;
        this.appendChild(draggedElement);
        resetDropZoneStyles();
      }
      return false;
    }

    function resetDropZoneStyles() {
      document.querySelectorAll('.drop-circle').forEach(c => {
        c.classList.remove('correct', 'incorrect', 'drag-over');
      });
    }

    function checkPlacement() {
      correctPlacements = 0;
      const dropCircles = document.querySelectorAll('.drop-circle');
      const incorrectItems = [];
      resetDropZoneStyles();

      dropCircles.forEach(circle => {
        const vessel = circle.querySelector('.vessel');
        const position = circle.dataset.position;

        if (vessel) {
          const vesselType = vessel.dataset.vessel;
          const expected = correctPositions[vesselType];

          if (expected === position) {
            correctPlacements++;
            circle.classList.add('correct');
          } else {
            circle.classList.add('incorrect');
            const areaType = circle.dataset.area;
            incorrectItems.push({
              vessel: vesselNames[vesselType],
              current: getAreaName(areaType),
              correct: getAreaName(expected.split('-')[0]),
              targetSpot: spotName(expected) // ×¤×™×¨×•×˜ × ×§×•×“×ª ×™×¢×“ ×‘×ª×•×š ×”××–×•×¨
            });
          }
        }
      });

      showResults(incorrectItems);
    }

    function getAreaName(area) {
      const names = {
        courtyard: '×—×¦×¨',
        kodesh: '×§×•×“×©',
        'kodesh-kodashim': '×§×•×“×© ×”×§×•×“×©×™×'
      };
      return names[area] || area;
    }

    // ×©× ×¢×–×¨ ×œ× ×§×•×“×ª ×”×™×™×¢×“ ×”××“×•×™×§×ª ×‘×ª×•×š ×”××–×•×¨ (×¦×¤×•×Ÿ/×“×¨×•×/××¨×›×–)
    function spotName(position) {
      if (position.startsWith('kodesh-')) {
        const idx = position.split('-')[1];
        if (idx === '0') return '×¦×¤×•×Ÿ';
        if (idx === '1') return '×“×¨×•×';
        if (idx === '2') return '××¨×›×–';
      }
      return '';
    }

    function showResults(incorrectItems) {
      const resultsDiv = document.getElementById('results');
      const scoreDiv = document.getElementById('score');
      const feedbackDiv = document.getElementById('feedback');

      scoreDiv.textContent = `×¦×™×•×Ÿ: ${correctPlacements}/${totalVessels} × ×›×•×Ÿ`;

      if (correctPlacements === totalVessels) {
        feedbackDiv.innerHTML = 'ğŸ‰ <strong>××•×©×œ×!</strong> ×›×œ ×”×›×œ×™× ×‘××§×•× ×”× ×›×•×Ÿ!';
        feedbackDiv.style.color = '#155724';
        showFinalCipher();
      } else {
        let feedback = 'âŒ <strong>×›×œ×™× ×©×œ× ×‘××§×•× ×”× ×›×•×Ÿ:</strong><br>';
        incorrectItems.forEach(item => {
          const spotText = item.targetSpot ? ` â€” × ×§×•×“×ª ×™×¢×“: ${item.targetSpot}` : '';
          feedback += `â€¢ ${item.vessel}: × ××¦× ×‘${item.current}, ×¦×¨×™×š ×œ×”×™×•×ª ×‘${item.correct}${spotText}<br>`;
        });
        feedbackDiv.innerHTML = feedback;
        feedbackDiv.style.color = '#721c24';
      }
      resultsDiv.style.display = 'block';
    }

    function toggleHints() {
      const hintsDiv = document.getElementById('hints');
      const isVisible = hintsDiv.classList.contains('show');
      if (isVisible) {
        hintsDiv.classList.remove('show');
      } else {
        hintsDiv.classList.add('show');
        showProgressiveHints();
      }
    }

    function showProgressiveHints() {
      document.getElementById('hint-courtyard').style.display = 'block';
      document.getElementById('hint-kodesh').style.display = 'block';
      document.getElementById('hint-kodesh-kodashim').style.display = 'block';
    }

    function showFinalCipher() {
      const cipherDiv = document.getElementById('final-cipher');
      setTimeout(() => {
        cipherDiv.classList.add('show');
        setTimeout(() => addNextPageButton(), 2000);
      }, 1000);
    }

    function addNextPageButton() {
      const cipherDiv = document.getElementById('final-cipher');
      if (cipherDiv.querySelector('button')) return;
      const nextBtn = document.createElement('button');
      nextBtn.className = 'btn check-btn';
      nextBtn.style.marginTop = '20px';
      nextBtn.textContent = '×¢×‘×•×¨ ×œ×¢××•×“ ×”×‘×';
      nextBtn.onclick = goToNextPage;
      cipherDiv.appendChild(nextBtn);
    }

    function goToNextPage() {
      alert('××¢×‘×¨ ×œ×¢××•×“ ×”×‘× - ×›××Ÿ ×™×”×™×” ×”×©×œ×‘ ×”×‘× ×©×œ ×”××©×—×§!');
    }

    function resetGame() {
      const vesselsContainer = document.querySelector('.vessels-container');
      document.querySelectorAll('.vessel').forEach(v => vesselsContainer.appendChild(v));
      resetDropZoneStyles();
      document.getElementById('results').style.display = 'none';
      document.getElementById('hints').classList.remove('show');
      document.getElementById('final-cipher').classList.remove('show');
      document.querySelectorAll('.hint-item').forEach(h => h.style.display = 'none');
      correctPlacements = 0;
    }

    // ×ª××™×›×” ×‘××’×¢
    let touchItem = null;
    document.addEventListener('touchstart', function (e) {
      if (e.target.classList.contains('vessel')) {
        touchItem = e.target;
        touchItem.classList.add('dragging');
      }
    });
    document.addEventListener('touchmove', function (e) {
      e.preventDefault();
    }, { passive: false });
    document.addEventListener('touchend', function (e) {
      if (touchItem) {
        const touch = e.changedTouches[0];
        const dropCircle = document.elementFromPoint(touch.clientX, touch.clientY);
        if (dropCircle && dropCircle.classList.contains('drop-circle') && dropCircle.children.length === 0) {
          dropCircle.appendChild(touchItem);
          resetDropZoneStyles();
        }
        touchItem.classList.remove('dragging');
        touchItem = null;
      }
    });
  </script>

  <!-- ×©××•×¨/×™ ××ª ×”×¡×§×¨×™×¤×˜ ×©×œ Cloudflare (×× ×“×¨×•×©) ××• ×”×¡×¨/×™ ××•×ª×• ×œ×¤×™ ×”×¦×•×¨×š -->
</body>
</html>
