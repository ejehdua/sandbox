<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>×¦×•×¤×Ÿ ×§×•×“×© ×”×§×•×“×©×™×</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700&display=swap');

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Heebo', sans-serif;
      background: #ffffff;         /* ×‘×œ×™ ×¨×§×¢ ××™×•×—×“ */
      min-height: 60vh;            /* × ××•×š ×™×•×ª×¨ */
      padding: 20px;
      overflow-x: auto;
    }

    .game-container {
      border-radius: 15px;
      padding: 15px;
      max-width: 960px;            /* ×¨×—×‘ ×™×•×ª×¨ */
      margin: 0 auto;
      border: 3px solid #daa520;   /* ××¡×’×¨×ª ×¢×“×™× ×” */
      background: transparent;     /* ×‘×œ×™ ×¨×§×¢ */
    }

    .title {
      text-align: center;
      color: #8b4513;
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .subtitle {
      text-align: center;
      color: #a0522d;
      font-size: 1rem;
      margin-bottom: 20px;
      font-weight: 500;
    }

    .tabernacle-layout {
      margin-bottom: 15px;
      display: flex;
      justify-content: center;
    }

    .courtyard {
      border: 3px solid #8b4513;
      border-radius: 10px;
      padding: 8px;
      position: relative;
      min-height: 120px;           /* ××¢×˜ × ××•×š ×™×•×ª×¨ */
      width: 100%;
      max-width: 700px;            /* ××¢×˜ ×¨×—×‘ ×™×•×ª×¨ */
      display: flex;
      flex-direction: column;
      background: transparent;     /* ×‘×œ×™ ×¨×§×¢ */
    }

    .area-title {
      position: absolute;
      top: -10px;
      left: 50%;
      transform: translateX(-50%);
      background: #fff;            /* ×ª×’×™×ª × ×§×™×™×” */
      padding: 2px 8px;
      border: 2px solid #8b4513;
      border-radius: 12px;
      font-weight: 600;
      color: #8b4513;
      font-size: 0.7rem;
    }

    .courtyard-drop-zone {
      min-height: 40px;
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 10px;
      justify-content: center;
      align-items: center;
    }

    .kodesh {
      border: 2px solid #daa520;
      border-radius: 6px;
      padding: 6px;
      position: relative;
      min-height: 70px;            /* × ××•×š ×™×•×ª×¨ */
      width: 90%;                  /* ××¢×˜ ×¨×—×‘ ×™×•×ª×¨ */
      margin: auto auto 0 auto;
      display: flex;
      flex-direction: column;
      background: transparent;     /* ×‘×œ×™ ×¨×§×¢ */
    }

    .kodesh-drop-zone {
      min-height: 30px;
      width: 100%;
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: 1fr 1fr;
      gap: 8px;
      justify-items: center;
      align-items: center;
    }

    /* ×¡×“×¨ ×”×¢×™×’×•×œ×™× ×‘×§×•×“×©:
       1 = ×¦×¤×•×Ÿ (×©×××œ ×œ××¢×œ×”), 2 = ×“×¨×•× (×™××™×Ÿ ×œ××¢×œ×”), 3 = ××¨×›×– (×©×•×¨×” ×©× ×™×™×”, ×‘×××¦×¢) */
    .kodesh-drop-zone .drop-circle:nth-child(1) { grid-column: 1; grid-row: 1; }
    .kodesh-drop-zone .drop-circle:nth-child(2) { grid-column: 2; grid-row: 1; }
    .kodesh-drop-zone .drop-circle:nth-child(3) { grid-column: 1 / 3; grid-row: 2; }

    .kodesh-kodashim {
      border: 2px solid #b8860b;
      border-radius: 4px;
      padding: 4px;
      position: relative;
      min-height: 30px;            /* × ××•×š ×™×•×ª×¨ */
      width: 75%;                  /* ××¢×˜ ×¨×—×‘ ×™×•×ª×¨ */
      margin: auto auto 0 auto;
      display: flex;
      justify-content: center;
      align-items: center;
      background: transparent;     /* ×‘×œ×™ ×¨×§×¢ */
    }

    .vessels-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-bottom: 15px;
      padding: 15px;
      border-radius: 10px;
      border: 2px dashed #daa520;
      background: transparent;     /* ×‘×œ×™ ×¨×§×¢ */
    }

    .vessel {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      cursor: grab;
      transition: all 0.3s ease;
      border: 2px solid;
      position: relative;
      user-select: none;
    }

    .vessel:hover { transform: scale(1.1); }
    .vessel.dragging { cursor: grabbing; transform: rotate(5deg) scale(1.1); z-index: 1000; }

    .vessel.bronze { background: #d08a52; border-color: #8b4513; color: #2f1b14; }
    .vessel.gold   { background: #ffe380; border-color: #daa520; color: #8b4513; }

    .vessel-tooltip {
      position: absolute;
      bottom: -30px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.85);
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 0.8rem;
      white-space: nowrap;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
      z-index: 1001;
    }
    .vessel:hover .vessel-tooltip { opacity: 1; }

    .drop-circle {
      width: 50px;
      height: 50px;
      border: 3px dashed #bfbfbf;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      position: relative;
      background: transparent;
    }

    .drop-circle.drag-over { border-color: #32cd32; }
    .drop-circle.correct   { background: rgba(50,205,50,0.2); border-color: #32cd32; }
    .drop-circle.incorrect { background: rgba(255,0,0,0.1);  border-color: #ff0000; }

    .controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      align-items: center;
      margin-bottom: 15px;
    }

    .btn {
      background: linear-gradient(135deg, #daa520, #b8860b);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Heebo', sans-serif;
    }
    .btn:hover { transform: translateY(-2px); }

    .btn.check-btn {
      background: linear-gradient(135deg, #28a745, #20c997);
      font-size: 1.2rem;
      padding: 15px 30px;
    }

    .hint-icon, .reset-icon {
      width: 50px; height: 50px; border-radius: 50%; color: white; border: none; cursor: pointer;
      display: flex; align-items: center; justify-content: center; transition: transform 0.2s ease;
    }
    .hint-icon  { background: #6b5b47; }
    .reset-icon { background: #c82333; }
    .hint-icon:hover, .reset-icon:hover { transform: scale(1.06); }

    .results {
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 20px;
      text-align: center;
      border: 2px solid #daa520;
      background: transparent;
    }

    .score { font-size: 1.2rem; font-weight: 600; color: #8b4513; margin-bottom: 10px; }

    .hints {
      border: 2px solid #ffeaa7;
      border-radius: 8px;
      padding: 15px;
      margin-top: 15px;
      display: none;
      background: #fffef7;
    }
    .hints.show { display: block; }
    .hint-item { color: #856404; margin-bottom: 8px; font-size: 0.9rem; }

    .final-cipher {
      border: 3px solid #daa520;
      border-radius: 15px;
      padding: 20px;
      text-align: center;
      margin-top: 20px;
      display: none;
      background: transparent;
    }
    .final-cipher.show { display: block; }
    .cipher-text { font-size: 1.5rem; font-weight: 700; margin-bottom: 15px; }

    /* ××¦×¤×Ÿ ×§×˜×Ÿ (×œ× ×—×•×‘×”, ×¨×§ ×¢×–×¨ ×•×™×–×•××œ×™) */
    .compass { display: flex; justify-content: center; margin-top: 10px; margin-bottom: 10px; }
    .compass-container {
      position: relative; width: 80px; height: 80px; border: 3px solid #8b4513; border-radius: 50%;
      display: flex; align-items: center; justify-content: center; background: transparent;
    }
    .compass-needle { width: 2px; height: 30px; background: #dc3545; position: absolute; transform-origin: top center; }
    .compass-needle::before {
      content: ''; position: absolute; bottom: -5px; left: -3px; width: 0; height: 0;
      border-left: 4px solid transparent; border-right: 4px solid transparent; border-top: 8px solid #dc3545;
    }
    .compass-directions { position: absolute; width: 100%; height: 100%; }
    .compass-directions span { position: absolute; font-size: 0.8rem; font-weight: bold; color: #8b4513; }
    .compass-directions .north { right: -8px; top: 50%; transform: translateY(-50%); }
    .compass-directions .south { left: -8px; top: 50%; transform: translateY(-50%); }
    .compass-directions .east  { bottom: -5px; left: 50%; transform: translateX(-50%); }
    .compass-directions .west  { top: -5px; left: 50%; transform: translateX(-50%); }

    @media (max-width: 768px) {
      .game-container { padding: 10px; margin: 10px; max-width: 100%; }
      .courtyard { max-width: 100%; min-height: 110px; }
    }
  </style>
</head>
<body>
  <div class="game-container">
    <h1 class="title">ğŸ—ï¸ ×¦×•×¤×Ÿ ×§×•×“×© ×”×§×•×“×©×™×</h1>
    <p class="subtitle">×’×¨×•×¨ ××ª ×›×œ×™ ×”××©×›×Ÿ ×œ××§×•×× ×”× ×›×•×Ÿ</p>

    <div class="vessels-container">
      <div class="vessel bronze" draggable="true" data-vessel="altar">
        ğŸ”¥
        <div class="vessel-tooltip">××–×‘×— ×”×¢×•×œ×”</div>
      </div>
      <div class="vessel bronze" draggable="true" data-vessel="laver">
        ğŸ’§
        <div class="vessel-tooltip">×›×™×•×¨</div>
      </div>
      <div class="vessel gold" draggable="true" data-vessel="menorah">
        ğŸ•¯ï¸
        <div class="vessel-tooltip">×× ×•×¨×”</div>
      </div>
      <div class="vessel gold" draggable="true" data-vessel="table">
        ğŸ
        <div class="vessel-tooltip">×©×•×œ×—×Ÿ ×œ×—× ×”×¤× ×™×</div>
      </div>
      <div class="vessel gold" draggable="true" data-vessel="incense">
        ğŸ’¨
        <div class="vessel-tooltip">××–×‘×— ×”×§×˜×•×¨×ª</div>
      </div>
      <div class="vessel gold" draggable="true" data-vessel="ark">
        â¬œ
        <div class="vessel-tooltip">××¨×•×Ÿ ×”×‘×¨×™×ª</div>
      </div>
    </div>

    <div class="tabernacle-layout">
      <div class="courtyard">
        <div class="area-title">×—×¦×¨</div>
        <div class="drop-zone courtyard-drop-zone" data-area="courtyard">
          <div class="drop-circle" data-area="courtyard" data-position="courtyard-0"></div>
          <div class="drop-circle" data-area="courtyard" data-position="courtyard-1"></div>
        </div>

        <div class="kodesh">
          <div class="area-title">×§×•×“×©</div>
          <div class="drop-zone kodesh-drop-zone" data-area="kodesh">
            <div class="drop-circle" data-area="kodesh" data-position="kodesh-0" title="×¦×¤×•×Ÿ"></div>
            <div class="drop-circle" data-area="kodesh" data-position="kodesh-1" title="×“×¨×•×"></div>
            <div class="drop-circle" data-area="kodesh" data-position="kodesh-2" title="××¨×›×–"></div>
          </div>

          <div class="kodesh-kodashim">
            <div class="area-title">×§×•×“×© ×”×§×•×“×©×™×</div>
            <div class="drop-zone" data-area="kodesh-kodashim">
              <div class="drop-circle" data-area="kodesh-kodashim" data-position="kodesh-kodashim-0"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="controls">
      <button class="hint-icon" onclick="toggleHints()" title="×”×¦×’ ×¨××–×™×">ğŸ’¡</button>
      <button class="btn check-btn" onclick="checkPlacement()">×‘×“×•×§ ××™×§×•×</button>
      <button class="reset-icon" onclick="resetGame()" title="×”×ª×—×œ ××—×“×©">ğŸ”„</button>
    </div>

    <div class="compass">
      <div class="compass-container">
        <div class="compass-needle"></div>
        <div class="compass-directions">
          <span class="north">×¦</span>
          <span class="south">×“</span>
          <span class="east">×</span>
          <span class="west">××¢</span>
        </div>
      </div>
    </div>

    <div class="results" id="results" style="display: none;">
      <div class="score" id="score"></div>
      <div id="feedback"></div>
    </div>

    <div class="hints" id="hints">
      <h3 style="color: #8b4513; margin-bottom: 15px;">ğŸ’¡ ×¨××–×™× ×œ××™×§×•× ×”×›×œ×™×:</h3>
      <div class="hint-item" id="hint-courtyard" style="display: none;">
        ğŸ”¥ <strong>×—×¦×¨:</strong> ×›×œ×™ ×”× ×—×•×©×ª â€” ××–×‘×— ×”×¢×•×œ×” ×•×›×™×•×¨
      </div>
      <div class="hint-item" id="hint-kodesh" style="display: none;">
        âœ¨ <strong>×§×•×“×©:</strong> ×× ×•×¨×” (×“×¨×•×), ×©×•×œ×—×Ÿ (×¦×¤×•×Ÿ), ××–×‘×— ×”×§×˜×•×¨×ª (××¨×›×–)
      </div>
      <div class="hint-item" id="hint-kodesh-kodashim" style="display: none;">
        ğŸ‘‘ <strong>×§×•×“×© ×”×§×•×“×©×™×:</strong> ××¨×•×Ÿ ×”×‘×¨×™×ª ×‘×œ×‘×“
      </div>
    </div>

    <div class="final-cipher" id="final-cipher">
      <div class="cipher-text">ğŸ—ï¸ ×”×¦×•×¤×Ÿ × ×—×©×£!</div>
      <div class="cipher-explanation">
        ×”××™×œ×” ×”×¡×•×“×™×ª ×”×™×: <strong>"×§×“×•×©×”"</strong><br><br>
        ×›×œ ×›×œ×™ ×‘××§×•××• ×”× ×›×•×Ÿ ×™×•×¦×¨ ××ª ××‘× ×” ×”××©×›×Ÿ,<br>
        ×”××¡××œ ×“×¨×’×•×ª ×§×“×•×©×” ××—×¦×¨ ××œ ×§×•×“×© ×”×§×•×“×©×™×.<br><br>
        ğŸ›ï¸ ×—×¦×¨ â† ×§×•×“×© â† ×§×•×“×© ×”×§×•×“×©×™× ğŸ›ï¸
      </div>
    </div>
  </div>

  <script>
    let draggedElement = null;
    let correctPlacements = 0;
    const totalVessels = 6;

    // ××™×¤×•×™ ××“×•×™×§ ×©×œ ×”×›×œ×™× ×œ×¢×™×’×•×œ×™×:
    // ×‘×§×•×“×©: kodesh-0 = ×¦×¤×•×Ÿ (×©×•×œ×—×Ÿ), kodesh-1 = ×“×¨×•× (×× ×•×¨×”), kodesh-2 = ××¨×›×– (×§×˜×•×¨×ª)
    const correctPositions = {
      altar: 'courtyard-0',
      laver: 'courtyard-1',
      table: 'kodesh-0',          // ×¦×¤×•×Ÿ
      menorah: 'kodesh-1',        // ×“×¨×•×
      incense: 'kodesh-2',        // ××¨×›×–
      ark: 'kodesh-kodashim-0'
    };

    const vesselNames = {
      altar: '××–×‘×— ×”×¢×•×œ×”',
      laver: '×›×™×•×¨',
      menorah: '×× ×•×¨×”',
      table: '×©×•×œ×—×Ÿ ×œ×—× ×”×¤× ×™×',
      incense: '××–×‘×— ×”×§×˜×•×¨×ª',
      ark: '××¨×•×Ÿ ×”×‘×¨×™×ª'
    };

    // Drag & Drop â€“ ×“×¡×§×˜×•×¤
    document.addEventListener('DOMContentLoaded', () => {
      const vessels = document.querySelectorAll('.vessel');
      const dropCircles = document.querySelectorAll('.drop-circle');

      vessels.forEach(v => {
        v.addEventListener('dragstart', handleDragStart);
        v.addEventListener('dragend', handleDragEnd);
      });

      dropCircles.forEach(c => {
        c.addEventListener('dragover', handleDragOver);
        c.addEventListener('dragenter', handleDragEnter);
        c.addEventListener('dragleave', handleDragLeave);
        c.addEventListener('drop', handleDrop);
      });
    });

    function handleDragStart(e) {
      draggedElement = this;
      this.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('text/html', this.outerHTML);
    }

    function handleDragEnd() {
      this.classList.remove('dragging');
      draggedElement = null;
    }

    function handleDragOver(e) {
      if (e.preventDefault) e.preventDefault();
      e.dataTransfer.dropEffect = 'move';
      return false;
    }

    function handleDragEnter() {
      this.classList.add('drag-over');
    }

    function handleDragLeave() {
      this.classList.remove('drag-over');
    }

    function handleDrop(e) {
      if (e.stopPropagation) e.stopPropagation();
      this.classList.remove('drag-over');

      if (draggedElement && this.children.length === 0) {
        this.appendChild(draggedElement);
        resetDropZoneStyles();
      }
      return false;
    }

    function resetDropZoneStyles() {
      document.querySelectorAll('.drop-circle').forEach(c => {
        c.classList.remove('correct', 'incorrect', 'drag-over');
      });
    }

    function checkPlacement() {
      correctPlacements = 0;
      const dropCircles = document.querySelectorAll('.drop-circle');
      const incorrectItems = [];
      resetDropZoneStyles();

      dropCircles.forEach(circle => {
        const vessel = circle.querySelector('.vessel');
        const position = circle.dataset.position;

        if (vessel) {
          const vesselType = vessel.dataset.vessel;
          const expected = correctPositions[vesselType];

          if (expected === position) {
            correctPlacements++;
            circle.classList.add('correct');
          } else {
            circle.classList.add('incorrect');
            const areaType = circle.dataset.area;
            incorrectItems.push({
              vessel: vesselNames[vesselType],
              current: getAreaName(areaType),
              correct: getAreaName(expected.split('-')[0]),
              targetSpot: spotName(expected)
            });
          }
        }
      });

      showResults(incorrectItems);
    }

    function getAreaName(area) {
      const names = {
        courtyard: '×—×¦×¨',
        kodesh: '×§×•×“×©',
        'kodesh-kodashim': '×§×•×“×© ×”×§×•×“×©×™×'
      };
      return names[area] || area;
    }

    function spotName(position) {
      if (position.startsWith('kodesh-')) {
        const idx = position.split('-')[1];
        if (idx === '0') return '×¦×¤×•×Ÿ';
        if (idx === '1') return '×“×¨×•×';
        if (idx === '2') return '××¨×›×–';
      }
      return '';
    }

    function showResults(incorrectItems) {
      const resultsDiv = document.getElementById('results');
      const scoreDiv = document.getElementById('score');
      const feedbackDiv = document.getElementById('feedback');

      scoreDiv.textContent = `×¦×™×•×Ÿ: ${correctPlacements}/${totalVessels} × ×›×•×Ÿ`;

      if (correctPlacements === totalVessels) {
        feedbackDiv.innerHTML = 'ğŸ‰ <strong>××•×©×œ×!</strong> ×›×œ ×”×›×œ×™× ×‘××§×•× ×”× ×›×•×Ÿ!';
        feedbackDiv.style.color = '#155724';
        showFinalCipher();
      } else {
        let feedback = 'âŒ <strong>×›×œ×™× ×©×œ× ×‘××§×•× ×”× ×›×•×Ÿ:</strong><br>';
        incorrectItems.forEach(item => {
          const spotText = item.targetSpot ? ` â€” × ×§×•×“×ª ×™×¢×“: ${item.targetSpot}` : '';
          feedback += `â€¢ ${item.vessel}: × ××¦× ×‘${item.current}, ×¦×¨×™×š ×œ×”×™×•×ª ×‘${item.correct}${spotText}<br>`;
        });
        feedbackDiv.innerHTML = feedback;
        feedbackDiv.style.color = '#721c24';
      }
      resultsDiv.style.display = 'block';
    }

    function toggleHints() {
      const hintsDiv = document.getElementById('hints');
      const isVisible = hintsDiv.classList.contains('show');
      if (isVisible) {
        hintsDiv.classList.remove('show');
      } else {
        hintsDiv.classList.add('show');
        showProgressiveHints();
      }
    }

    function showProgressiveHints() {
      document.getElementById('hint-courtyard').style.display = 'block';
      document.getElementById('hint-kodesh').style.display = 'block';
      document.getElementById('hint-kodesh-kodashim').style.display = 'block';
    }

    function showFinalCipher() {
      const cipherDiv = document.getElementById('final-cipher');
      setTimeout(() => {
        cipherDiv.classList.add('show');
        setTimeout(() => addNextPageButton(), 2000);
      }, 1000);
    }

    function addNextPageButton() {
      const cipherDiv = document.getElementById('final-cipher');
      if (cipherDiv.querySelector('button')) return;
      const nextBtn = document.createElement('button');
      nextBtn.className = 'btn check-btn';
      nextBtn.style.marginTop = '20px';
      nextBtn.textContent = '×¢×‘×•×¨ ×œ×¢××•×“ ×”×‘×';
      nextBtn.onclick = goToNextPage;
      cipherDiv.appendChild(nextBtn);
    }

    function goToNextPage() {
      alert('××¢×‘×¨ ×œ×¢××•×“ ×”×‘× - ×›××Ÿ ×™×”×™×” ×”×©×œ×‘ ×”×‘× ×©×œ ×”××©×—×§!');
    }

    function resetGame() {
      const vesselsContainer = document.querySelector('.vessels-container');
      document.querySelectorAll('.vessel').forEach(v => vesselsContainer.appendChild(v));
      resetDropZoneStyles();
      document.getElementById('results').style.display = 'none';
      document.getElementById('hints').classList.remove('show');
      document.getElementById('final-cipher').classList.remove('show');
      document.querySelectorAll('.hint-item').forEach(h => h.style.display = 'none');
      correctPlacements = 0;
    }

    // ×ª××™×›×” ×‘××¡×›×™ ××’×¢
    let touchItem = null;
    document.addEventListener('touchstart', function (e) {
      if (e.target.classList.contains('vessel')) {
        touchItem = e.target;
        touchItem.classList.add('dragging');
      }
    });
    document.addEventListener('touchmove', function (e) {
      e.preventDefault();
    }, { passive: false });
    document.addEventListener('touchend', function (e) {
      if (touchItem) {
        const touch = e.changedTouches[0];
        const dropCircle = document.elementFromPoint(touch.clientX, touch.clientY);
        if (dropCircle && dropCircle.classList.contains('drop-circle') && dropCircle.children.length === 0) {
          dropCircle.appendChild(touchItem);
          resetDropZoneStyles();
        }
        touchItem.classList.remove('dragging');
        touchItem = null;
      }
    });
  </script>
</body>
</html>
