<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>צופן קודש הקודשים</title>
  <!-- שמור/י את בלוק ה-CSS הקיים שלך כמות שהוא -->
</head>
<body style="background: transparent !important;">
  <div class="game-container"
       style="background: transparent !important; box-shadow: none !important;">
    <h1 class="title">🗝️ צופן קודש הקודשים</h1>
    <p class="subtitle">גרור את כלי המשכן למקומם הנכון</p>

    <div class="vessels-container" style="background: transparent !important;">
      <div class="vessel bronze" draggable="true" data-vessel="altar">
        🔥
        <div class="vessel-tooltip">מזבח העולה</div>
      </div>
      <div class="vessel bronze" draggable="true" data-vessel="laver">
        💧
        <div class="vessel-tooltip">כיור</div>
      </div>
      <div class="vessel gold" draggable="true" data-vessel="menorah">
        🕯️
        <div class="vessel-tooltip">מנורה</div>
      </div>
      <div class="vessel gold" draggable="true" data-vessel="table">
        🍞
        <div class="vessel-tooltip">שולחן לחם הפנים</div>
      </div>
      <div class="vessel gold" draggable="true" data-vessel="incense">
        💨
        <div class="vessel-tooltip">מזבח הקטורת</div>
      </div>
      <div class="vessel gold" draggable="true" data-vessel="ark">
        ⬜
        <div class="vessel-tooltip">ארון הברית</div>
      </div>
    </div>

    <div class="tabernacle-layout">
      <div class="courtyard" style="background: transparent !important;">
        <div class="area-title">חצר</div>
        <div class="drop-zone courtyard-drop-zone" data-area="courtyard">
          <div class="drop-circle" data-area="courtyard" data-position="courtyard-0"></div>
          <div class="drop-circle" data-area="courtyard" data-position="courtyard-1"></div>
        </div>

        <div class="kodesh" style="background: transparent !important;">
          <div class="area-title">קודש</div>
          <!-- חשובה פריסת העיגולים: 
               kodesh-0 = צפון (שמאל למעלה), kodesh-1 = דרום (ימין למעלה), kodesh-2 = מרכז (שורה שנייה, אמצע) -->
          <div class="drop-zone kodesh-drop-zone" data-area="kodesh">
            <div class="drop-circle" data-area="kodesh" data-position="kodesh-0" title="צפון"></div>
            <div class="drop-circle" data-area="kodesh" data-position="kodesh-1" title="דרום"></div>
            <div class="drop-circle" data-area="kodesh" data-position="kodesh-2" title="מרכז"></div>
          </div>

          <div class="kodesh-kodashim" style="background: transparent !important;">
            <div class="area-title">קודש הקודשים</div>
            <div class="drop-zone" data-area="kodesh-kodashim">
              <div class="drop-circle" data-area="kodesh-kodashim" data-position="kodesh-kodashim-0"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="controls">
      <button class="hint-icon" onclick="toggleHints()" title="הצג רמזים">💡</button>
      <button class="btn check-btn" onclick="checkPlacement()">בדוק מיקום</button>
      <button class="reset-icon" onclick="resetGame()" title="התחל מחדש">🔄</button>
    </div>

    <div class="compass">
      <div class="compass-container">
        <div class="compass-needle"></div>
        <div class="compass-directions">
          <span class="north">צ</span>
          <span class="south">ד</span>
          <span class="east">מ</span>
          <span class="west">מע</span>
        </div>
      </div>
    </div>

    <div class="results" id="results" style="display: none;">
      <div class="score" id="score"></div>
      <div id="feedback"></div>
    </div>

    <div class="hints" id="hints">
      <h3 style="color: #8b4513; margin-bottom: 15px;">💡 רמזים למיקום הכלים:</h3>
      <div class="hint-item" id="hint-courtyard" style="display: none;">
        🔥 <strong>חצר:</strong> כלי הנחושת — מזבח העולה וכיור
      </div>
      <div class="hint-item" id="hint-kodesh" style="display: none;">
        ✨ <strong>קודש:</strong> מנורה (דרום), שולחן (צפון), מזבח הקטורת (מרכז)
      </div>
      <div class="hint-item" id="hint-kodesh-kodashim" style="display: none;">
        👑 <strong>קודש הקודשים:</strong> ארון הברית בלבד
      </div>
    </div>

    <div class="final-cipher" id="final-cipher" style="background: transparent !important; border: none !important;">
      <div class="cipher-text">🗝️ הצופן נחשף!</div>
      <div class="cipher-explanation">
        המילה הסודית היא: <strong>"קדושה"</strong><br><br>
        כל כלי במקומו הנכון יוצר את מבנה המשכן,<br>
        המסמל דרגות קדושה מחצר אל קודש הקודשים.<br><br>
        🏛️ חצר ← קודש ← קודש הקודשים 🏛️
      </div>
    </div>
  </div>

  <script>
    let draggedElement = null;
    let correctPlacements = 0;
    const totalVessels = 6;

    // מיפוי מדויק לעיגולים:
    // בקודש: kodesh-0 = צפון (שולחן), kodesh-1 = דרום (מנורה), kodesh-2 = מרכז (קטורת)
    const correctPositions = {
      altar: 'courtyard-0',
      laver: 'courtyard-1',
      table: 'kodesh-0',          // צפון
      menorah: 'kodesh-1',        // דרום
      incense: 'kodesh-2',        // מרכז
      ark: 'kodesh-kodashim-0'
    };

    const vesselNames = {
      altar: 'מזבח העולה',
      laver: 'כיור',
      menorah: 'מנורה',
      table: 'שולחן לחם הפנים',
      incense: 'מזבח הקטורת',
      ark: 'ארון הברית'
    };

    document.addEventListener('DOMContentLoaded', function () {
      const vessels = document.querySelectorAll('.vessel');
      const dropCircles = document.querySelectorAll('.drop-circle');

      vessels.forEach(v => {
        v.addEventListener('dragstart', handleDragStart);
        v.addEventListener('dragend', handleDragEnd);
      });

      dropCircles.forEach(c => {
        c.addEventListener('dragover', handleDragOver);
        c.addEventListener('dragenter', handleDragEnter);
        c.addEventListener('dragleave', handleDragLeave);
        c.addEventListener('drop', handleDrop);
      });
    });

    function handleDragStart(e) {
      draggedElement = this;
      this.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('text/html', this.outerHTML);
    }

    function handleDragEnd() {
      this.classList.remove('dragging');
      draggedElement = null;
    }

    function handleDragOver(e) {
      if (e.preventDefault) e.preventDefault();
      e.dataTransfer.dropEffect = 'move';
      return false;
    }

    function handleDragEnter() {
      this.classList.add('drag-over');
    }

    function handleDragLeave() {
      this.classList.remove('drag-over');
    }

    function handleDrop(e) {
      if (e.stopPropagation) e.stopPropagation();
      this.classList.remove('drag-over');

      if (draggedElement && this.children.length === 0) {
        const original = draggedElement.parentNode;
        this.appendChild(draggedElement);
        resetDropZoneStyles();
      }
      return false;
    }

    function resetDropZoneStyles() {
      document.querySelectorAll('.drop-circle').forEach(c => {
        c.classList.remove('correct', 'incorrect', 'drag-over');
      });
    }

    function checkPlacement() {
      correctPlacements = 0;
      const dropCircles = document.querySelectorAll('.drop-circle');
      const incorrectItems = [];
      resetDropZoneStyles();

      dropCircles.forEach(circle => {
        const vessel = circle.querySelector('.vessel');
        const position = circle.dataset.position;

        if (vessel) {
          const vesselType = vessel.dataset.vessel;
          const expected = correctPositions[vesselType];

          if (expected === position) {
            correctPlacements++;
            circle.classList.add('correct');
          } else {
            circle.classList.add('incorrect');
            const areaType = circle.dataset.area;
            incorrectItems.push({
              vessel: vesselNames[vesselType],
              current: getAreaName(areaType),
              correct: getAreaName(expected.split('-')[0]),
              targetSpot: spotName(expected) // פירוט נקודת יעד בתוך האזור
            });
          }
        }
      });

      showResults(incorrectItems);
    }

    function getAreaName(area) {
      const names = {
        courtyard: 'חצר',
        kodesh: 'קודש',
        'kodesh-kodashim': 'קודש הקודשים'
      };
      return names[area] || area;
    }

    // שם עזר לנקודת הייעד המדויקת בתוך האזור (צפון/דרום/מרכז)
    function spotName(position) {
      if (position.startsWith('kodesh-')) {
        const idx = position.split('-')[1];
        if (idx === '0') return 'צפון';
        if (idx === '1') return 'דרום';
        if (idx === '2') return 'מרכז';
      }
      return '';
    }

    function showResults(incorrectItems) {
      const resultsDiv = document.getElementById('results');
      const scoreDiv = document.getElementById('score');
      const feedbackDiv = document.getElementById('feedback');

      scoreDiv.textContent = `ציון: ${correctPlacements}/${totalVessels} נכון`;

      if (correctPlacements === totalVessels) {
        feedbackDiv.innerHTML = '🎉 <strong>מושלם!</strong> כל הכלים במקום הנכון!';
        feedbackDiv.style.color = '#155724';
        showFinalCipher();
      } else {
        let feedback = '❌ <strong>כלים שלא במקום הנכון:</strong><br>';
        incorrectItems.forEach(item => {
          const spotText = item.targetSpot ? ` — נקודת יעד: ${item.targetSpot}` : '';
          feedback += `• ${item.vessel}: נמצא ב${item.current}, צריך להיות ב${item.correct}${spotText}<br>`;
        });
        feedbackDiv.innerHTML = feedback;
        feedbackDiv.style.color = '#721c24';
      }
      resultsDiv.style.display = 'block';
    }

    function toggleHints() {
      const hintsDiv = document.getElementById('hints');
      const isVisible = hintsDiv.classList.contains('show');
      if (isVisible) {
        hintsDiv.classList.remove('show');
      } else {
        hintsDiv.classList.add('show');
        showProgressiveHints();
      }
    }

    function showProgressiveHints() {
      document.getElementById('hint-courtyard').style.display = 'block';
      document.getElementById('hint-kodesh').style.display = 'block';
      document.getElementById('hint-kodesh-kodashim').style.display = 'block';
    }

    function showFinalCipher() {
      const cipherDiv = document.getElementById('final-cipher');
      setTimeout(() => {
        cipherDiv.classList.add('show');
        setTimeout(() => addNextPageButton(), 2000);
      }, 1000);
    }

    function addNextPageButton() {
      const cipherDiv = document.getElementById('final-cipher');
      if (cipherDiv.querySelector('button')) return;
      const nextBtn = document.createElement('button');
      nextBtn.className = 'btn check-btn';
      nextBtn.style.marginTop = '20px';
      nextBtn.textContent = 'עבור לעמוד הבא';
      nextBtn.onclick = goToNextPage;
      cipherDiv.appendChild(nextBtn);
    }

    function goToNextPage() {
      alert('מעבר לעמוד הבא - כאן יהיה השלב הבא של המשחק!');
    }

    function resetGame() {
      const vesselsContainer = document.querySelector('.vessels-container');
      document.querySelectorAll('.vessel').forEach(v => vesselsContainer.appendChild(v));
      resetDropZoneStyles();
      document.getElementById('results').style.display = 'none';
      document.getElementById('hints').classList.remove('show');
      document.getElementById('final-cipher').classList.remove('show');
      document.querySelectorAll('.hint-item').forEach(h => h.style.display = 'none');
      correctPlacements = 0;
    }

    // תמיכה במגע
    let touchItem = null;
    document.addEventListener('touchstart', function (e) {
      if (e.target.classList.contains('vessel')) {
        touchItem = e.target;
        touchItem.classList.add('dragging');
      }
    });
    document.addEventListener('touchmove', function (e) {
      e.preventDefault();
    }, { passive: false });
    document.addEventListener('touchend', function (e) {
      if (touchItem) {
        const touch = e.changedTouches[0];
        const dropCircle = document.elementFromPoint(touch.clientX, touch.clientY);
        if (dropCircle && dropCircle.classList.contains('drop-circle') && dropCircle.children.length === 0) {
          dropCircle.appendChild(touchItem);
          resetDropZoneStyles();
        }
        touchItem.classList.remove('dragging');
        touchItem = null;
      }
    });
  </script>

  <!-- שמור/י את הסקריפט של Cloudflare (אם דרוש) או הסר/י אותו לפי הצורך -->
</body>
</html>
